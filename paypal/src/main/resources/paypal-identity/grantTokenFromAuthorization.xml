<template name="grantTokenFromAuthorization" xmlns="http://ws.apache.org/ns/synapse">
  <!-- Required parameters -->
  <parameter name="grantType" description="Token grant type"/>
  <parameter name="code" description="Authorization code previously received from the authorization server"/>
  <parameter name="redirectUri" description="Redirection endpoint"/>
  <parameter name="authorization" description="Authorization header value"/>
  <sequence>
    <property name="uri.var.grantType" expression="$func:grantType"/>
    <property name="uri.var.code" expression="$func:code"/>
    <property name="uri.var.redirectUri" expression="$func:redirectUri"/>
    <payloadFactory media-type="json">
    	<format>
			{
				"bypassJson":"true"
			}
		</format>
    </payloadFactory>
    <property name="messageType" value="application/json" scope="axis2"/>
    <property xmlns:ns2="http://org.apache.synapse/xsd" xmlns:ns="http://org.apache.synapse/xsd" 
     	xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope" name="Authorization" expression="$func:authorization"
     	scope="transport" type="STRING"/>
    <call>
      <endpoint>
        <http method="post" uri-template="{uri.var.paypalUrl}/v1/identity/openidconnect/tokenservice?grant_type={uri.var.grantType}&amp;code={uri.var.code}&amp;redirect_uri={uri.var.redirectUri}"/>
      </endpoint>
    </call>
  </sequence>
</template>