<template name="createLead" xmlns="http://ws.apache.org/ns/synapse">

  <parameter name="user_name" description="The Name of the user such as admin"/>
  <parameter name="password" description="Password MD5 converted"/>
  <parameter name="first_name" description="First Name of the user"/>
  <parameter name="last_name" description="Last name of teh user"/>
  <parameter name="email_address" description="Email Address of the user"/>
  
  <sequence>
  
    <property name="uri.var.user_name" expression="$func:user_name"/>
    <property name="uri.var.password" expression="$func:password"/>
    <property name="uri.var.first_name" expression="$func:first_name"/>
    <property name="uri.var.last_name" expression="$func:last_name"/>
    <property name="uri.var.email_address" expression="$func:email_address"/>
    
    <payloadFactory>
    
      <format>
    
       		<sug:create_lead xmlns:sug="http://www.sugarcrm.com/sugarcrm">
		         <sug:user_name>$1</sug:user_name>
		         <sug:password>$2</sug:password>
		         <sug:first_name>$3</sug:first_name>
		         <sug:email_address>$4</sug:email_address>				         
		  	</sug:create_lead>   
    
      </format>
      
      <args>
      	   <arg expression="get-property('uri.var.user_name')"/>
           <arg expression="get-property('uri.var.password')"/>
           <arg expression="get-property('uri.var.first_name')"/>
           <arg expression="get-property('uri.var.email_address')"/>
      </args> 
    
    </payloadFactory>
    
    <header name="To" expression="get-property('uri.var.sugarCRMurl')"/>
	    
    <call>
		<endpoint>
			<default format="soap11"/>
		</endpoint>
	</call>
    
  </sequence>
</template>