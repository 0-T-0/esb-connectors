<template name="searchByModule" xmlns="http://ws.apache.org/ns/synapse">

  <parameter name="user_name"/>
  <parameter name="password"/>
  <parameter name="search_string"/>
  <parameter name="modules"/>
  <parameter name="offset"/>
  <parameter name="max_results"/>
  
  <sequence>
  
    <property name="uri.var.user_name" expression="$func:user_name"/>
    <property name="uri.var.password" expression="$func:password"/>
    <property name="uri.var.search_string" expression="$func:search_string"/>
    <property name="uri.var.modules" expression="$func:modules"/>
    <property name="uri.var.offset" expression="$func:offset"/>
    <property name="uri.var.max_results" expression="$func:max_results"/>
  
    <payloadFactory>
	
	  <format>
	
	  	<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
            	xmlns:sug="http://www.sugarcrm.com/sugarcrm"
            	xmlns:xsd="http://www.w3.org/2001/XMLSchema"
            	xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/">
           	<soapenv:Header/>
            <soapenv:Body>
            	<sug:search_by_module>
            		<sug:user_name>$1</sug:user_name>
		            <sug:password>$2</sug:password>
		            <sug:search_string>$3</sug:search_string>
		            <sug:modules soapenc:arrayType="xsd:string[1]"></sug:modules>
		            <sug:offset>$4</sug:offset>
		            <sug:max_results>$5</sug:max_results>
            	</sug:search_by_module>
            </soapenv:Body>
        </soapenv:Envelope>
      </format>
	  
	  <args>
         <arg expression="get-property('uri.var.user_name')"/>
         <arg expression="get-property('uri.var.password')"/>
         <arg expression="get-property('uri.var.search_string')"/>
         <arg expression="get-property('uri.var.offset')"/>
         <arg expression="get-property('uri.var.max_results')"/>
      </args>
    
    </payloadFactory>
    
    <class name="org.wso2.carbon.connector.sugarcrm.operation.SearchByModule" />
    <enrich>
		<source clone="true" type="body" />
		<target property="MSG_PAYLOAD" type="property" />
   	</enrich>
    
    <header name="To" expression="get-property('uri.var.sugarCRMurl')"/>
    
    <call>
		<endpoint>
			<default format="soap11"/>
		</endpoint>
	</call>

  </sequence>

</template>