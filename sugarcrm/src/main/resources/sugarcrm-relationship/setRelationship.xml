<template name="setRelationship" xmlns="http://ws.apache.org/ns/synapse">

  <parameter name="module1" description="Module 1"/>
  <parameter name="module1_id" description="Module 1 Id"/>
  <parameter name="module2" description="Module 2"/>
  <parameter name="module2_id" description="Module 2 Id"/>

  <sequence class="sequence">

    <property name="uri.var.module1" expression="$func:module1"/>
    <property name="uri.var.module1_id" expression="$func:module1_id"/>
    <property name="uri.var.module2" expression="$func:module2"/>
    <property name="uri.var.module2_id" expression="$func:module2_id"/>

    <payloadFactory>

	  <format>

   		 <sug:set_relationship xmlns:sug="http://www.sugarcrm.com/sugarcrm">
   		     <session>$1</session>
	         <sug:set_relationship_value>
	            <module1>$2</module1>
	            <module1_id>$3</module1_id>
	            <module2>$4</module2>
	            <module2_id>$5</module2_id>
	         </sug:set_relationship_value>
	      </sug:set_relationship>
	  
	  </format>
	  
	  <args>
          <arg expression="get-property('uri.var.session')"/>
          <arg expression="get-property('uri.var.module1')"/>
          <arg expression="get-property('uri.var.module1_id')"/>
          <arg expression="get-property('uri.var.module2')"/>
          <arg expression="get-property('uri.var.module2_id')"/>
      </args>
      
    </payloadFactory>
    
    <header name="To" expression="get-property('uri.var.sugarCRMurl')"/>
    
    <call>
		<endpoint>
			<default format="soap11"/>
		</endpoint>
	</call>
	
  </sequence>
  
</template>