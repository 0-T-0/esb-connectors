<template xmlns="http://ws.apache.org/ns/synapse" name="getSegmentsById">
    <sequence>
    <parameter name="identifier" description="Visitor's identity information"/>
    <parameter name="identifierType" description="Type of visitor's identity information."/>

    <sequence>
        <property name="acquia.contextdb.identifier" expression="$func:identifier"/>
        <property name="acquia.contextdb.identifierType" expression="$func:identifierType"/>

        <property name="acquia.contextdb.URL_PARAMETERS"  expression="fn:concat(get-property('acquia.contextdb.identifier'),'&amp;',get-property('acquia.contextdb.identifierType')"/>

        <property name="acquia.contextdb.apiUri" expression="fn:concat(get-property('/segments'))"/>
        <property name="uri.var.apiUri" expression="get-property('acquia.contextdb.apiUri')"/>
        <property name="uri.var.apiUri" expression="get-property('acquia.contextdb.URL_PARAMETERS')"/>
        <call>
            <endpoint>
                <http method="GET"
                      uri-template="{uri.var.apiUri}&amp;{uri.var.URL_PARAMETERS}"/>
            </endpoint>
        </call>
    </sequence>
</template>