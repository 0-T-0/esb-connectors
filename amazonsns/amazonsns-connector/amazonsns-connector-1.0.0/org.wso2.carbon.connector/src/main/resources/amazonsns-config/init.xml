<template name="init" xmlns="http://ws.apache.org/ns/synapse">
	<parameter name="region" description="Region which is used. Select a regional endpoint to make requests." />
	<parameter name="accessKeyId" description="The access key ID that corresponds to the secret access key that is used to sign the request." />
	<parameter name="secretAccessKey" description="The secret access key of the account." />
	<parameter name="version" description="The API version that the request is written for." />
	
	<sequence>
		<property name="uri.var.region" expression="$func:region" />
		<property name="uri.var.accessKeyId" expression="$func:accessKeyId" />
		<property name="uri.var.secretAccessKey" expression="$func:secretAccessKey" />
		<property name="uri.var.version" expression="$func:version" />
		
		<!-- Common values to be used in all methods -->
		<property name="uri.var.contentType" value="application/x-www-form-urlencoded" />
		<property name="uri.var.httpMethod" value="POST" />
		<property name="uri.var.terminationString" value="aws4_request" />
		<property name="uri.var.signatureMethod" value="HmacSHA256" />
		<property name="uri.var.signatureVersion" value="4" />
		<property name="uri.var.service" value="sns" />
		<property name="uri.var.httpRequestUri" value="/" />
		
		<property name="DISABLE_CHUNKING" value="true" scope="axis2" />
		<property name="messageType" value="application/x-www-form-urlencoded" scope="axis2" />
		
		<!-- 
		Need to add port 80 to the 'hostName'property(used to create signature) to match the signature generated by API end.
		Note that ESB sends Host header with port value, hence API uses the receiving value(including port) to generate signature. 
		-->
		<property name="uri.var.hostName" expression="fn:concat(get-property('uri.var.service') ,'.' , get-property('uri.var.region') , '.amazonaws.com:80')" />
		<property name="uri.var.apiUrl" expression="fn:concat('http://' , get-property('uri.var.hostName'))" />

	</sequence>
</template>